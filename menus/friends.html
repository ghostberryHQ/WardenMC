<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="../styles_play.css">
    <link rel="stylesheet" href="../circles_play.css">
    <script src="../main.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <meta charset="UTF-8">
    <title>Warden</title>
  </head>
  <body>
    <div class="area" >
        <ul class="circles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div >
        <script>

          const { ipcRenderer } = require('electron');

          /* Kristuff.WebUI.SideMenu */
(function (window, undefined) {
    'use strict';
    // responsive pinnable sidemenu component
    var sideMenu = function (el) {
        var htmlSideMenu = el, htmlSideMenuPinTrigger = {}, htmlSideMenuPinTriggerImage = {}, htmlOverlay = {};
        var init = function () {
            htmlSideMenuPinTrigger = el.querySelector('.wui-side-menu-pin-trigger');
            htmlOverlay = document.querySelector('.wui-overlay');
            Array.prototype.forEach.call(document.querySelectorAll('.wui-side-menu-trigger'), function (elmt, i) {
                elmt.addEventListener('click', function (e) {
                    e.preventDefault();
                    toggleMenuState();
                }, false);
            });
            htmlOverlay.addEventListener("click", function (e) {
                htmlSideMenu.classList.remove('open');
            }, false);
            window.addEventListener("resize", checkIfNeedToCloseMenu, false);
            checkIfNeedToCloseMenu();
        };
        var toggleMenuState = function () {
            htmlSideMenu.classList.toggle('open');
            menuStateChanged(htmlSideMenu, htmlSideMenu.classList.contains('open'));
        };
        var toggleMenuPinState = function () {
            htmlSideMenu.classList.toggle('pinned');
            htmlSideMenuPinTriggerImage.classList.toggle('fa-rotate-90');
            if (htmlSideMenu.classList.contains('pinned') !== true) {
                htmlSideMenu.classList.remove('open');
            }
            menuPinStateChanged(htmlSideMenu, htmlSideMenu.classList.contains('pinned'));
        };
        var checkIfNeedToCloseMenu = function () {
            var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
            if (width <= 767 && htmlSideMenu.classList.contains('open') === true) {
                htmlSideMenu.classList.remove('open');
                menuStateChanged(htmlSideMenu, htmlSideMenu.classList.contains('open'));
            }
            if (width > 767 && htmlSideMenu.classList.contains('pinned') === false) {
                htmlSideMenu.classList.remove('open');
                menuStateChanged(htmlSideMenu, htmlSideMenu.classList.contains('open'));
            }
        };
        var menuStateChanged = function (element, state) {
            var evt = new CustomEvent('menuStateChanged', { detail: { open: state} });
            element.dispatchEvent(evt);
        };
        var menuPinStateChanged = function (element, state) {
            var evt = new CustomEvent('menuPinStateChanged', { detail: { pinned: state} });
            element.dispatchEvent(evt);
        };
        init();
        return {
            htmlElement: htmlSideMenu,
            toggleMenuState: toggleMenuState,
            toggleMenuPinState: toggleMenuPinState
        };
    };
    
    window.SideMenu = sideMenu;
})(window);


var documentReady = function (fn) {
  if (document.readyState != 'loading') {
    fn();
  } else {
    document.addEventListener('DOMContentLoaded', fn);
  }
};

documentReady(function() {
  var sample = new SideMenu(document.querySelector('.wui-side-menu'))
  sample.htmlElement.addEventListener('menuPinStateChanged', function(e) {
    document.querySelector('#events').innerHTML += 'menuPinStateChanged , menu pinned? => ' 
      + e.detail.pinned + '<br>'; 
  }, false);
  sample.htmlElement.addEventListener('menuStateChanged', function(e) {
    document.querySelector('#events').innerHTML += 'menuStateChanged , menu open? => ' 
      + e.detail.open + '<br>'; 
  }, false);
});

function showToast(text){
        var isShowing = false;
        var x=document.getElementById("toast");
        if(isShowing == false) {
          x.classList.add("show");
          var isShowing = true;
          x.innerHTML=text;
          setTimeout(function(){
            x.classList.remove("show");
            var isShowing = false;
        },3000);
        }
      }

window.onload = () => {
    //get url perameters
    var urlParams = new URLSearchParams(window.location.search);
    var username = urlParams.get('uuid');


    console.log(username);
    fetch (`https://api.persn.dev/warden/getFriends/${username}`)
    .then(response => response.json())
    .then(data => {
      if(data.error === "User not found.") {
        document.getElementById("noFriendsMessage").style.display = 'block';
      } else{
        document.getElementById("noFriendsMessage").style.display = 'none';
        var friends = data.friends;
        var friendList = document.getElementById("friendsList");
        if(friends.length == 0){
          friendList.innerHTML = "You have no friends";
        } else {
          for (var i = 0; i < friends.length; i++) {
            var friendElement = document.createElement("li");
            friendElement.className = "friend";
            fetch("https://api.mojang.com/user/profile/" + friends[i].uuid)
            .then(response => response.json())
            .then(data => {
              friendElement.innerHTML = data.name;
            });
            friendList.appendChild(friendElement);
          }
        }
      }
    });
  }
</script>

<div class="wui-side-menu open pinned" data-wui-theme="dark">    
  <ul class="wui-side-menu-items">
    <li>
      <a href="../play.html" class="wui-side-menu-item">
        <b><span class="box-title"><i style="margin-right:5px;" class="fa-solid fa-gamepad"></i>Play</span></b>
      </a>
    </li>
    <li>
      <a id="friendsTab" href="./friends.html?uuid=" class="wui-side-menu-item active">
        <b><span class="box-title"><i style="margin-right:5px;" class="fa-solid fa-user-group"></i>Friends</span></b>
      </a>
    </li>
    <li>
      <a id="accountsTab" href="./accounts.html?uuid=" class="wui-side-menu-item">
        <b><span class="box-title"><i style="margin-right:5px;" class="fa-solid fa-person"></i>Accounts</span></b>
      </a>
    </li>
    <li>
      <a id="cosmeticsTab" href="#" class="wui-side-menu-item">
        <b><span class="box-title"><i style="margin-right:5px;" class="fa-solid fa-shirt"></i>Cosmetics</span></b>
      </a>
    </li>
    <li>
      <a id="settingsTab" href="./menus/settings.html?uuid=" class="wui-side-menu-item">
        <b><span class="box-title"><i style="margin-right:5px;" class="fa-solid fa-gear"></i>Settings</span></b>
      </a>
    </li>
    <li>
      <a href="#" class="wui-side-menu-item" style="bottom:0; position:absolute;" onclick="signOut();">
        <b><span class="box-title"><i style="margin-right:5px;" class="fa-solid fa-right-from-bracket"></i>Sign Out</span></b>
      </a>
    </li>
  </ul>
</div>
<div class="wui-content">
  <div class="wui-content-header">
    <a href="#" class="wui-side-menu-trigger"><i class="fa fa-bars"></i></a>
  </div> 
  <div class="wui-content-main">
    <center>

      <style>
          li:hover {
            background-color: #595b59;
            border-radius:5%;
          }
          .friend {
            list-style-type: none;
            padding: 10px;
            margin-left: 0;
            border-radius:5%;
            text-align: left;
          }
          .inviteButton {
            float: right;
            background-color: #5cb85c;
            border: none;
            color: white;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
            border-radius: 3px;
          }
          .inviteButton:hover {
            background-color: #4a934a;
          }

      </style>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      <h1>Friends</h1>
      <h3 id="noFriendsMessage" style="position:absolute; bottom:50%; left:28%; opacity: 60%;">You currently have no friends</h3>
      
      <div id="friendsList" style="position:absolute; bottom:10%; left:15%; background-color:#4c4c4c; border-radius:5%; width:400px; height:400px; opacity: 60%;">
        <br>
        <!-- <li class="friend">MrMrGamer <button class="inviteButton">Invite</button></li>
        <li class="friend">ThisIsntAFakePerson <button class="inviteButton">Invite</button></li> -->
      </div>
      <ul id="myUl"></ul>
      </div>
    </center>
    <div id="events"></div>
    <div id="toast"></div>
  </div>
</div>
  </div>


  <script>
    var urlParams = new URLSearchParams(window.location.search);
    var uuid = urlParams.get('uuid');
    document.getElementById("accountsTab").href = "./accounts.html?uuid=" + uuid;
    document.getElementById("cosmeticsTab").href = "./cosmetics.html?uuid=" + uuid;
    document.getElementById("settingsTab").href = "./settings.html?uuid=" + uuid;
  </script>
</html>